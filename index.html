<script>
  const COST = 0.5;
  const countEl = document.getElementById('count');
  const totalEl = document.getElementById('total');
  const addBtn = document.getElementById('add');
  const resetBtn = document.getElementById('reset');

  async function fetchCount() {
    const { data, error } = await supabase
      .from('counter')
      .select('count')
      .eq('id', 1)
      .single();

    if (data) {
      updateDisplay(data.count);
    }
  }

  async function updateCount(newCount) {
    await supabase
      .from('counter')
      .update({ count: newCount })
      .eq('id', 1);
    updateDisplay(newCount);
  }

  function updateDisplay(count) {
    countEl.textContent = count;
    totalEl.textContent = (count * COST).toFixed(2);
  }

  addBtn.onclick = async () => {
    const { data } = await supabase.from('counter').select('count').eq('id', 1).single();
    const newCount = data.count + 1;
    await updateCount(newCount);
  };

  resetBtn.onclick = async () => {
    if (confirm("Reset your 'Deepot' counter?")) {
      await updateCount(0);
    }
  };

  fetchCount();
</script>
